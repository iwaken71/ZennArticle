---
title: "Azure Spatial Anchorsã§ã®ä½ç½®å›ºå®šã‚’HoloLens,iOS,Androidã§çœºã‚ã‚‹ã¨ã“ã‚ã¾ã§ä¸€æ°—é€šè²«"
emoji: "ğŸ”¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Unity","HoloLens","Azure"]
published: true
---
# æ¦‚è¦
Azure Spatial Anchorsã¯ã€ç©ºé–“ã‚’èªè­˜ã—ãŸä½ç½®å›ºå®šã‚„è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ã§ã®ã‚¢ãƒ³ã‚«ãƒ¼å…±æœ‰ã‚’å¯èƒ½ã«ã™ã‚‹MicrosoftãŒæä¾›ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚

![](https://docs.microsoft.com/ja-jp/azure/spatial-anchors/media/cross-platform.png)

https://docs.microsoft.com/ja-jp/azure/spatial-anchors/overview

ç¿’å¾—ã™ã‚‹ãŸã‚ã«ã€Microsoft Learnã®[Azure Spatial Anchors ã‚’ä½¿ç”¨ã—ã¦å®Ÿä¸–ç•Œã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å›ºå®šã™ã‚‹](https://docs.microsoft.com/ja-jp/learn/modules/azure-spatial-anchors-tutorials/)ã‚’é€²ã‚ã¦ã„ã‚‹ã¨ã€é€”ä¸­ã§ **ã€Œã“ã“ã¯ã“ã®ãƒšãƒ¼ã‚¸ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€** ãªã©ã€ä»–ã®Webãƒšãƒ¼ã‚¸ã«é£›ã¶å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
åˆã‚ã¦ã®Azure Spatial Anchorã«å–ã‚Šçµ„ã‚€å ´åˆ **ã€Œã©ã“ã¾ã§å–ã‚Šè¾¼ã‚ã°ã„ã„ã‚“ã ã‚ã†...?ã€** ã¨ä¸å®‰ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®è¨˜äº‹ã§ã¯ **ä¸€æ°—é€šè²«** ã‚’ã‚³ãƒ³ã‚»ãƒ—ãƒˆã«ã€HoloLensã¨iOS,Androidã§Azure Spatial Anchorã‚’ä½¿ã£ã¦ä½ç½®å›ºå®šã™ã‚‹ã¨ã“ã‚ã¾ã§å–ã‚Šåˆãˆãšå‹•ã‹ã™ã¨ã“ã‚ã¾ã§ä¸€æ°—é€šè²«ã§èª¬æ˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

ãã®ãŸã‚ã€è¨˜äº‹ãŒé•·ããªã‚‹ã‹ã¨æ€ã„ã¾ã™ãŒã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚

## ã“ã®è¨˜äº‹ã§å®Ÿç¾ã™ã‚‹ã“ã¨

- HoloLens,iOS,Androidã§Azure Spatial Anchorã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚µãƒ³ãƒ—ãƒ«ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹
- iOSã¨Androidã§Azure Spatial Anchorã«ã‚ˆã‚‹ä½ç½®å›ºå®šã‚’ä½“é¨“ã™ã‚‹

å®Ÿéš›ã«Androidã§å‹•ã‹ã—ã¦ã¿ãŸãƒ‡ãƒ¢å‹•ç”»ãŒã“ã¡ã‚‰ã€‚
Find Anchorã™ã‚‹ã¨ã€äº‹å‰ã«å›ºå®šã—ãŸä½ç½®ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæˆ»ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚(ç©ºé–“ã«å¯¾ã—ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å›ºå®šã™ã‚‹ã“ã¨ãŒã§ãã‚‹)

https://youtu.be/xjDg0AYUPYo

## ã“ã®è¨˜äº‹ã§å®Ÿç¾ã§ããªã‹ã£ãŸã“ã¨

- HoloLensã«ã‚ˆã‚‹ä½ç½®å›ºå®š
- HoloLens,iOS,Androidé–“ã§ã®ä½ç½®å…±æœ‰

ã“ã¡ã‚‰ã¯æ¬¡å›ä»¥é™ã®è¨˜äº‹ã§ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã«ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

# èª­è€…å¯¾è±¡

- Unityã‚’ä½¿ã£ãŸHoloLens,iOS,Androidé–‹ç™ºã¯ã‚„ã£ãŸã“ã¨ãŒã‚ã‚‹
- Azureã‚’ä½¿ã†ã®ã¯åˆã‚ã¦
- Azure Spatial Anchorsã‚’ä½¿ã†ã®ã‚‚åˆã‚ã¦

# ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®å‰ææ¡ä»¶ (Learnãƒšãƒ¼ã‚¸ã‹ã‚‰å¼•ç”¨)

https://docs.microsoft.com/ja-jp/learn/modules/azure-spatial-anchors-tutorials/

- [æ­£ã—ã„ãƒ„ãƒ¼ãƒ«](https://docs.microsoft.com/ja-jp/windows/mixed-reality/develop/install-the-tools)ãŒæ§‹æˆã•ã‚ŒãŸ Windows 10 PC
- Windows 10 SDK 10.0.18362.0 ä»¥é™
- é–‹ç™ºç”¨ã«æ§‹æˆã•ã‚ŒãŸ HoloLens 2 ãƒ‡ãƒã‚¤ã‚¹
- Unity 2020.3.X ã¾ãŸã¯ 2019.4.X ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã€ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ« Windows ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  ãƒ“ãƒ«ãƒ‰ ã‚µãƒãƒ¼ãƒˆ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè¿½åŠ ã•ã‚ŒãŸ Unity Hub
- [Unity ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ Mixed Reality ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¨­å®šã™ã‚‹](https://docs.microsoft.com/ja-jp/learn/modules/mixed-reality-toolkit-project-unity/)
    - **ã“ã¡ã‚‰ã‚‚ã“ã®è¨˜äº‹ã§æ‰‹é †ã‚’èª¬æ˜ã—ã¾ã™ã€‚**
- [Mixed Reality Feature Tool](https://www.microsoft.com/en-us/download/details.aspx?id=102778)
- Unity ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã€ã‚·ãƒ¼ãƒ³ã®ä½œæˆã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã€ã‚·ãƒ¼ãƒ³ã¸ã® GameObjects ã®è¿½åŠ ã«é–¢ã™ã‚‹åŸºæœ¬çš„ãªçŸ¥è­˜
- ã€Œ[Spatial Anchors ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹](https://docs.microsoft.com/ja-jp/azure/spatial-anchors/quickstarts/get-started-unity-hololens?tabs=azure-portal#create-a-spatial-anchors-resource)ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ (ã‚¯ã‚¤ãƒƒã‚¯ ã‚¹ã‚¿ãƒ¼ãƒˆ:Azure Spatial Anchors ã‚’ä½¿ç”¨ã™ã‚‹ Unity HoloLens ã‚¢ãƒ—ãƒªã‚’ä½œæˆã™ã‚‹ ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã«ã‚ã‚Šã¾ã™) ã‚’å®Œäº†ã—ã¾ã™ã€‚
    - **ã“ã¡ã‚‰ã‚‚ã“ã®è¨˜äº‹ã§æ‰‹é †ã‚’èª¬æ˜ã—ã¾ã™ã€‚**

# è‘—è€…ã®ç’°å¢ƒ

|é …ç›®|ãƒãƒ¼ã‚¸ãƒ§ãƒ³|
|---|---|
|Windowsãƒãƒ¼ã‚¸ãƒ§ãƒ³|Windows10 Home|
|Visual Studio 2019|-|
|Unity|2020.3.18f1|
|HoloLens2|-|
|Mixed Reality Feature Tool|1.0.2111.0-Preview|

|Unityã®Plugin|ãƒãƒ¼ã‚¸ãƒ§ãƒ³|
|---|---|
|Mixed Reality Toolkit Foundation|2.7.3|
|Mixed Reality OpenXR|1.3.0|
|Azure Spatial Anchors SDK|2.12.0|
|AR Foundation|4.1.7|
|ARCore XR|4.1.9|
|ARkit XR|4.1.9|

# ã“ã®è¨˜äº‹ã«ã‚ˆã‚‹æ‰‹é †ã®ç›®æ¬¡

- Unityã§HoloLensãƒ“ãƒ«ãƒ‰ç”¨ã®MRTKã¨OpenXRã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹
- Azureã§Spatial Anchors ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹
- Azure Spatial Anchorå‘ã‘ã«Unityã®è¨­å®š
- ãƒ¢ãƒã‚¤ãƒ«(iOS,Android)ç”¨ã®è¨­å®š
- Androidå‘ã‘ãƒ“ãƒ«ãƒ‰ã®è¨­å®š
- iOSå‘ã‘ãƒ“ãƒ«ãƒ‰ã®è¨­å®š
- Azure Spatial Anchorsã®è©¦ã—æ–¹

# Unityã§HoloLensãƒ“ãƒ«ãƒ‰ç”¨ã®MRTKã¨OpenXRã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹

ä¸»ã«Unityä¸Šã§ã®ä½œæ¥­ã«ãªã‚Šã¾ã™ã€‚
MRTKã®importã®ã‚„ã‚Šæ–¹ã¯è¤‡æ•°ã‚ã‚Šã¾ã™ãŒã€ã“ã®è¨˜äº‹ã§ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ²¿ã£ã¦Mixed Reality Feature Toolã‚’ä½¿ã£ãŸæ‰‹æ³•ã§è¡Œã£ã¦ã„ã¾ã™ã€‚

## æ‰‹é †

Unityãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ã

- Versionã‚’2020.3.xxã‚’é¸æŠ
    - ç§ã¯2020.3.18f1
- ã€ŒAzureSpatialAnchorsSampleã€ã¨åå‰ã‚’ä»˜ã‘ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ

![](/images/hololens-2022-2/2022-02-11-12-19-30.png)

Build Settingsã‹ã‚‰ **[Universal Windows Platform]** ã«Switch Platform

Build Settingsã‚’é–‹ãä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã™ã‚‹

| é …ç›®                     | é¸æŠã™ã¹ãè¨­å®š   |
| ------------------------ | ---------------- |
| Target Device            | **HoloLens**     |
| Architecture             | **ARM64**        |
| Build Type               | D3D Project      |
| Target SDK Version       | Latest installed |
| Minimum Platform Version | 10.0.10230.0     |
| Visual Studio Version    | Latest installed |
| Build and Run on         | Local Machine    |
| Build configuration      | Release          |


![](/images/hololens-2022-2/2022-02-12-21-12-46.png)

TextMeshProã®é‡è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹

- [Window] > [TextMeshPro] > [Import TMP Essential Resources] ã‚’é¸æŠ

![](/images/hololens-2022-2/2022-02-11-13-43-20.png)

- Mixed Reality Toolkit ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¨ Unity ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹æˆ

ã“ã®è¨˜äº‹ã§ã¯[Mixed Reality Feature Tool](https://www.microsoft.com/en-us/download/details.aspx?id=102778)ã‹ã‚‰æ§‹æˆã—ã¾ã™ã€‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦exeãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€‚ç§ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯1.0.2111.0-Previewã§ã—ãŸã€‚

ã“ã“ã‹ã‚‰[Start]ã‚’ã‚¯ãƒªãƒƒã‚¯

![](/images/hololens-2022-2/2022-02-11-13-45-31.png)

:::message
ProjectPathã‚’è¨­å®šã¯ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚’å«ã‚€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é¸æŠ
- Assets
- Packages
- ProjectSettings
:::

ã§ããŸã‚‰ **[Discover Features]** ã‚’é¸æŠã€‚

![](/images/hololens-2022-2/2022-02-11-13-48-24.png)

Mixed Reality Toolkitã®

- Mixed Reality Toolkit Foundation 2.7.3
- Mixed Reality Toolkit Examples 2.7.3 (Option)
- Mixed Reality Toolkit Standard Assets 2.7.3 (Option)

Platform Supportã®

- Mixed Reality OpenXR Plugin 1.3.0

ã‚’é¸æŠã—ã¦ã€[Get Features]ã‚’é¸æŠã€‚
Examplesã¨Standard Assetsã¯å¿…é ˆã§ãªã„ã‹ã‚‚ã—ã‚Œãªã„ãŒã€ä¸å®‰ãªã®ã§è¿½åŠ ã€‚

![](/images/hololens-2022-2/2022-02-12-16-33-44.png)

ãã®ã¾ã¾[Approve]ã‚’é¸æŠã€‚
importãŒå§‹ã¾ã‚Šã¾ã™ã€‚ã“ã“ã§Unityã«æˆ»ã‚Šã¾ã™ã€‚

ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒã§ãŸã‚‰Yesã‚’é¸æŠã€‚

![](/images/hololens-2022-2/2022-02-12-16-03-16.png)

[MRTK Project Configurator]ã®WindowãŒç¾ã‚Œã‚‹ã€‚

:::message
[MRTK Project Configurator]ã®WindowãŒå‡ºãªã„å ´åˆã¯
Unityãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰[Mixed Reality] > [Toolkit] > [Utilities] > [Configure Project for MRTK]ã‚’é¸æŠ
:::


ä»Šå›ã¯[Unity OpenXR Plugin]ã‚’é¸æŠã€‚

![](/images/hololens-2022-2/2022-02-12-16-00-50.png)

**[Project Settings]** > **[XR Plug-in Management]** ã‹ã‚‰
- **[Windows Platform]ã‚¿ãƒ–** > **[Plug-in Providers]** > **[OpenXR]** ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã€‚
- **[Microsoft HoloLens feature group]** ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã€‚

![](/images/hololens-2022-2/2022-02-12-16-38-56.png)

[Project Settings]ã®[XR Plug-in Management]>[OpenXR]ã‚’é–‹ã
- Depth Submission Modeã‚’ **[Depth 16 Bit]** ã‚’é¸æŠã€‚
- Interaction Profilesã§ **[Microsoft Hand Interaction Profile]** ã‚’é¸æŠã€‚

![](/images/hololens-2022-2/2022-02-12-16-41-58.png)

MRTK Project Configuratorã‚’é–‹ãã€[Apply Settings]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå¾Œã«ã€[Next]ã‚’ã‚¯ãƒªãƒƒã‚¯ã€‚
![](/images/hololens-2022-2/2022-02-12-16-44-31.png)

[Apply]ã‚’ã‚¯ãƒªãƒƒã‚¯ã€‚
![](/images/hololens-2022-2/2022-02-12-16-45-44.png)

Project Settingsã®OpenXRã‚’é–‹ã„ã¦è­¦å‘Šãƒãƒ¼ã‚¯ãŒã‚ã£ãŸã‚‰ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€Fix Allã‚’é¸æŠã€‚
![](/images/hololens-2022-2/2022-02-12-19-06-58.png)

Unityã®Editorã«æˆ»ã‚‹ã€‚
ã€ŒAzureSpatialAnchorsã€ã¨ã„ã†åå‰ã®Sceneã‚’ä½œã‚‹ã€‚
ã“ã“ã‹ã‚‰HoloLensç”¨ã«Sceneã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ã€‚

[Mixed Reality]>[Toolkit]>[Add to Scene and Configure...]ã‚’é¸æŠã€‚
![](/images/hololens-2022-2/2022-02-12-19-10-15.png)

MRTKæ§‹æˆãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’DefaultHoloLens2ConfigurationProfileã«ã™ã‚‹ã€‚

- ãƒ’ã‚¨ãƒ©ãƒ«ã‚­ãƒ¼ä¸Šã®MixedReality Toolkitã‚’é¸æŠ
- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®MixedRealityToolKitã‚’è¦‹ã¦[DefaultHoloLens2ConfigurationProfile]ã‚’é¸æŠ
    - Cloneã‚’é¸æŠ
- Clone Profileã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
    - ProfileNameã‚’å…¥ã‚Œã‚‹ (ä»Šå›ã¯ã€ŒAzureSpatialAnchorsConfigurationProfileã€ã‚’å…¥åŠ›)
    - Cloneã‚’é¸æŠ

![](/images/hololens-2022-2/2022-02-12-19-14-45.png)

ç©ºé–“èªè­˜ãƒ¡ãƒƒã‚·ãƒ¥ã®è¡¨ç¤ºã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’Occlusionã«å¤‰æ›´ã™ã‚‹ã€‚

- MixedRealityToolKitã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®[Spatial Awareness]ã‚’é¸æŠ
    - Enable Spatial Awareness Systemã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹
    - Cloneã‚’é¸æŠ
- Clone Profileã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
    - ProfileNameã‚’å…¥ã‚Œã‚‹(ä»Šå›ã¯ã€ŒAzureSpatialAnchorsSpatialAwarenessSystemProfileã€ã‚’å…¥åŠ›)
    - Cloneã‚’é¸æŠ

![](/images/hololens-2022-2/2022-02-12-19-20-03.png)

- OpenXR Spatial Mesh Observerã®â–¼ã‚’é¸æŠã—ã¦é–‹ã
    - Cloneã‚’ã‚¯ãƒªãƒƒã‚¯
- Clone Profileã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
    - ProfileNameã‚’å…¥ã‚Œã‚‹(ä»Šå›ã¯ã€ŒAzureSpatialAnchorsSpatialAwarenessMeshObserverProfileã€ã‚’å…¥åŠ›)
    - Cloneã‚’é¸æŠ

![](/images/hololens-2022-2/2022-02-12-19-25-07.png)

Display Optionã§ã€ŒOcclusionã€ã‚’é¸æŠã™ã‚‹ã€‚

![](/images/hololens-2022-2/2022-02-12-19-31-15.png)

BuildSettingã‚’é–‹ã

- ç¾åœ¨ã®Sceneã‚’Scenes in Buildã«è¿½åŠ ã™ã‚‹
- Player Settingsã®[Publishing Settings]>[Packaging]>[Package name]ã‚’å…¥åŠ›ã™ã‚‹
    - ä»Šå›ã¯ã€ŒAzureAnchorSampleã€ã‚’å…¥åŠ›

![](/images/hololens-2022-2/2022-02-12-19-39-18.png)

ã“ã‚Œã§MRTKã¨OpenXRã®è¨­å®šã¯æº–å‚™OKã§ã™ï¼



# Azureã§Spatial Anchorsãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹

https://docs.microsoft.com/ja-jp/azure/spatial-anchors/quickstarts/get-started-unity-hololens?tabs=azure-portal#create-a-spatial-anchors-resource

ã“ã®ä¸­èº«ã‚’è¦‹ãªãŒã‚‰é€²ã‚ã¦ã„ãã¾ã™ã€‚ä»Šå›ã€GUIã§æ“ä½œã§ãã‚‹(ä¸€èˆ¬ã®äººã«å„ªã—ã„)Azureãƒãƒ¼ã‚¿ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ãƒ•ãƒ­ãƒ¼ã‚’è¡Œã„ã¾ã™ã€‚

## æ‰‹é †

- [Azureãƒãƒ¼ã‚¿ãƒ«](https://portal.azure.com/)ã«ã‚¢ã‚¯ã‚»ã‚¹
- **[ãƒªã‚½ãƒ¼ã‚¹ã®ä½œæˆ]** ã‚’é¸æŠ
- æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨ã—ã¦ **ã€ŒSpatial Anchorsã€** ã‚’æ¤œç´¢
- **[Spatial Anchors]** ã‚’é¸æŠã—ã¦ **[ä½œæˆ]** ã‚’é¸æŠ

Create Spatial Anchorsã®ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã¾ã™ã€‚
- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³
    - [Pay-As-You-Go] or [å¾“é‡èª²é‡‘]
        - ä»Šå›ç§ã¯ **[Pay-As-You-Go]** ã‚’é¸æŠ
    - ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—
        - ã€ŒmyResourceGroupã€ã¨åå‰ã‚’ä»˜ã‘ã€ [OK] ã‚’é¸æŠã—ã¾ã™ã€‚
- ãƒªã‚½ãƒ¼ã‚¹ã‚’é…ç½®ã™ã‚‹å ´æ‰€ (ãƒªãƒ¼ã‚¸ãƒ§ãƒ³)ã‚’é¸æŠ (ç§ãŒè¡Œã£ãŸé¸æŠã‚’å…±æœ‰)
    - åå‰ã¯ã€ŒTokyoã€ã‚’å…¥åŠ›
        - ã‚‚ã£ã¨ã‚ã‹ã‚Šã‚„ã™ã„åå‰ãŒãŠã™ã™ã‚ã§ã™ã€ŒMyAppSpatialAnchorsã€ãªã©
    - ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã€ŒKorea Centralã€ã‚’é¸æŠ (Japan EastãŒãªã‹ã£ãŸ)
- **[ç¢ºèªã¨ä½œæˆ]** ã‚’é¸æŠï¼

![](/images/hololens-2022-2/2022-02-11-12-49-21.png)

ã•ã‚‰ã« **[ä½œæˆ]** ã‚’é¸æŠã€‚

ã“ã“ã¾ã§ã„ãã¨ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå§‹ã¾ã‚Šã¾ã™ã€‚å®Œäº†ç”»é¢ãŒè¡¨ã‚Œã¾ã™ã€‚

![](/images/hololens-2022-2/2022-02-11-12-52-54.png)

**[ãƒªã‚½ãƒ¼ã‚¹ã«ç§»å‹•]** ã‚’é¸æŠ

![](/images/hololens-2022-2/2022-02-11-12-59-04.png)

ä»¥ä¸‹ã®æƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãƒ¡ãƒ¢å¸³ãªã©ã«æ§ãˆã¦ãŠã (å¾Œã§ä½¿ç”¨ã—ã¾ã™)
- AccountID
- Account Domain
- Access Keysã®Primary key


::: message alert
Primary keyãªã©ã¯ä»–äººã«å…¬é–‹ã—ãªã„ã‚ˆã†ã«ã™ã‚‹
:::

![](/images/hololens-2022-2/2022-02-11-13-02-51.png)



# Azure Spatial Anchorå‘ã‘ã«Unityã®è¨­å®š

https://docs.microsoft.com/ja-jp/learn/modules/azure-spatial-anchors-tutorials/3-exercise-get-started-with-azure-spatial-anchors

ã“ã¡ã‚‰ã«æˆ»ã£ã¦é€²ã‚ã¾ã™ã€‚

## ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®ã‚¢ã‚»ãƒƒãƒˆã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã€‚

ä»¥ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

- Mixed Reality OpenXR Plugin 1.3.1
- Windows XR Plugin 4.5.0
- ARCore XR Plugin 4.1.9
- ARKit XR Plugin 4.1.9
- AR Foundation 4.1.7

## ASA(Azure Spatial Anchors)ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

Microsoft Mixed Reality Feature Tool.exeã‚’é–‹ãã€‚

- Azure Spatial Anchors SDK Core 2.12.0
- Azure Spatial Anchors for Windows 2.12.0

ã‚’é¸æŠã€‚[Get Features]ã‚’ã‚¯ãƒªãƒƒã‚¯ã€‚[Import],[Approve]ã‚’é¸æŠã€‚

![](/images/hololens-2022-2/2022-02-12-22-32-22.png)

[ProjectSettings]>[Player]>[Publishing Settings]>[Capabilities]ã«ã¦ã€ä»¥ä¸‹ã«ãƒã‚§ãƒƒã‚¯ãŒå…¥ã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚

- SpatialPerception
- InternetClient
- **PrivateNetworkClientServer**

![](/images/hololens-2022-2/2022-02-12-22-36-54.png)



[ã“ã¡ã‚‰ã®ãƒšãƒ¼ã‚¸](https://github.com/microsoft/MixedRealityLearning/releases)ã‹ã‚‰ã€ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ç”¨ã®unitypackageã‚’2ã¤ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—importã™ã‚‹ã€‚
ä»Šå›ã¯

- [MRTK.HoloLens2.Unity.Tutorials.Assets.GettingStarted.2.7.2.unitypackage](https://github.com/microsoft/MixedRealityLearning/releases/download/getting-started-v2.7.2/MRTK.HoloLens2.Unity.Tutorials.Assets.GettingStarted.2.7.2.unitypackage)
- [MRTK.HoloLens2.Unity.Tutorials.Assets.AzureSpatialAnchors.2.7.2.unitypackage](https://github.com/microsoft/MixedRealityLearning/releases/download/azure-spatial-anchors-v2.7.2/MRTK.HoloLens2.Unity.Tutorials.Assets.AzureSpatialAnchors.2.7.2.unitypackage)

ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’é¸æŠã€‚â†‘ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚

## ã‚·ãƒ¼ãƒ³ã®æº–å‚™ (ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«)

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«ã¦[Assets]> [MRTK.Tutorials.AzureSpatialAnchors] > [Prefabs]ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®ä»¥ä¸‹ã®Prefabã‚’Hierarchyã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«ãƒ‰ãƒ©ãƒƒã‚°ã§è¿½åŠ ã—ã¾ã™ã€‚

- ButtonParent Prefab
- DebugWindow Prefab
- Instructions Prefab
- ParentAnchor Prefab

![](/images/hololens-2022-2/2022-02-12-22-50-25.png)

Hieraruchyãƒ“ãƒ¥ãƒ¼ã®[MixedReality Toolkit]ã‚’é¸æŠã€‚
Inspectorãƒ“ãƒ¥ãƒ¼ã®[Add Component]ã‹ã‚‰

- [AR Anchor Manager]
- [DisableDiagnosticsSystem]

ã‚’è¿½åŠ ã€‚

![](/images/hololens-2022-2/2022-02-12-23-04-20.png)

Hieraruchyãƒ“ãƒ¥ãƒ¼ã§[ButtonParent]ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å±•é–‹ã—ã€[StartAzureSession]ã¨ã„ã†åå‰ã®å­ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã—ã€Inspectorãƒ“ãƒ¥ãƒ¼ã§ã€Button Config Helperã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®OnClick()ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¬¡ã®ã‚ˆã†ã«æ§‹æˆã—ã¾ã™ã€‚

- ParentAnchorã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’[None (Object)]ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å‰²ã‚Šå½“ã¦ã¾ã™ã€‚
- No Functionã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‹ã‚‰ã€[AnchorModuleScript] > [StartAzureSession()]ã®é †ã«é¸æŠã—ã€ã“ã®é–¢æ•°ã‚’ã‚¤ãƒ™ãƒ³ãƒˆãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚ŒãŸã¨ãã«å®Ÿè¡Œã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨ã—ã¦è¨­å®šã—ã¾ã™ã€‚

![](/images/hololens-2022-2/2022-02-12-23-09-13.png)

åŒæ§˜ãªè¨­å®šã‚’ã€ãã®ä»–ã®ãƒœã‚¿ãƒ³ã«å¯¾ã—ã¦ã‚‚è¡Œã„ã¾ã™ã€‚

- [StopAzureSessionã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ]
    - ParentAnchor ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ [None (Object)] ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å‰²ã‚Šå½“ã¦ã¾ã™
    - No Functionã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‹ã‚‰ã€[AnchorModuleScript] > [StopAzureSession()]ã®é †ã«é¸æŠ
- [CreateAzureAnchorã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ]
    - ParentAnchor ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ [None (Object)] ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å‰²ã‚Šå½“ã¦ã¾ã™
    - No Functionã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‹ã‚‰ã€[AnchorModuleScript] > [CreateAzureAnchor()]ã®é †ã«é¸æŠ
    - **ParentAnchorã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ** ã‚’ç©ºã® [None (Object)] ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å‰²ã‚Šå½“ã¦ã‚‹ã€‚
- [RemoveLocalAnchorã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ]
    - ParentAnchor ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ [None (Object)] ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å‰²ã‚Šå½“ã¦ã¾ã™
    - No Functionã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‹ã‚‰ã€[AnchorModuleScript] > [RemoveLocalAnchor()]ã®é †ã«é¸æŠ
    - **ParentAnchorã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ** ã‚’ç©ºã® [None (Object)] ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å‰²ã‚Šå½“ã¦ã‚‹ã€‚
- [FindAzureAnchorã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ]
    - ParentAnchor ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ [None (Object)] ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å‰²ã‚Šå½“ã¦ã¾ã™
    - No Functionã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‹ã‚‰ã€[AnchorModuleScript] > [FindAzureAnchor()]ã®é †ã«é¸æŠ
- [DeleteAzureAnchorã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ]
    - ParentAnchor ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ [None (Object)] ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å‰²ã‚Šå½“ã¦ã¾ã™
    - No Functionã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‹ã‚‰ã€[AnchorModuleScript] > [DeleteAzureAnchor()]ã®é †ã«é¸æŠ

## Azureãƒªã‚½ãƒ¼ã‚¹ã«æ¥ç¶šã™ã‚‹

[ParentAnchor]ã®[Spatial Anchor Manager]ã®

- Spatial Anchors Account id
- Spatial Anchors Account Key
- Spatial Anchors Domain

ã«ã€å‰åŠã§ã‚³ãƒ”ãƒ¼ã—ãŸæ–‡å­—åˆ—ã‚’ä»£å…¥ã€‚

![](/images/hololens-2022-2/2022-02-12-23-31-10.png)


ã“ã®çŠ¶æ…‹ã§HoloLensã«ãƒ“ãƒ«ãƒ‰ï¼

ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãŒ

```
Reference rewriter: Error: type `System.Web.HttpUtility` doesn't exist in target framework. It is referenced from RestSharp.dll at System.String RestSharp.Extensions.StringExtensions::UrlDecode(System.String).
UnityEngine.Debug:LogError (object)
PostProcessWinRT:RunReferenceRewriter () (at C:/buildslave/unity/build/PlatformDependent/MetroPlayer/Extensions/Managed/PostProcessWinRT.cs:1195)
PostProcessWinRT:Process () (at C:/buildslave/unity/build/PlatformDependent/MetroPlayer/Extensions/Managed/PostProcessWinRT.cs:203)
UnityEngine.GUIUtility:ProcessEvent (int,intptr,bool&)

```

[ã“ã¡ã‚‰ã®è¨˜äº‹](https://github.com/microsoft/MixedRealityToolkit-Unity/issues/8839)ã‚’å‚è€ƒã«ä¿®æ­£ã€‚

Projectãƒ–ãƒ©ã‚¦ã‚¶

- [MRTK.Tutorials.AzureSpatialAnchors\Plugins\RestSharp.dll]ã‚’é¸æŠ

Inspectorãƒ“ãƒ¥ãƒ¼ã‚’é–‹ã

- [Platform settings]>[SDK]>[UWP]ã‚’é¸æŠ
- Don't processã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹
- [Select platforms for plugin]
    - [Any Platform]ã®**ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã™**
    - ä¸‹ã«ã‚ã‚‹å…¨ã¦ã®Include Platformsã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã€‚
- [Apply]ã‚’ã‚¯ãƒªãƒƒã‚¯

![](/images/hololens-2022-2/2022-02-12-23-48-24.png)

## ä½“é¨“ã‚’å›ºå®šã™ã‚‹

Hierarchyãƒ“ãƒ¥ãƒ¼ã§[ParentAnchor]ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã—ã€Transformã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã—ã¾ã™

- Scale (1.1,0.1,1.1) 

Projectãƒ–ãƒ©ã‚¦ã‚¶

- [Assets]> [MRTK.Tutorials.GettingStarted] > [Prefabs] > [Rover] > [RoverExplorer_Complete]Prefabã‚’ã‚·ãƒ¼ãƒ³ã«è¿½åŠ ã™ã‚‹ã€‚
- [ParentAnchor]ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å­ä¾›ã«[RoverExplorer_Complete]ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç½®ãã€‚

![](/images/hololens-2022-2/2022-02-13-00-51-22.png)

## ã‚·ãƒ¼ãƒ³ã®æº–å‚™

Hierarchyãƒ“ãƒ¥ãƒ¼ã§[ButtonParent]ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å±•é–‹ã—ã€éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã£ã¦ã„ã‚‹å­ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã—ã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹ã€‚

![](/images/hololens-2022-2/2022-02-13-01-06-50.png)

[ButtonParent]ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã—ã€Inspectorãƒ“ãƒ¥ãƒ¼ã«ã¦[GridObjectCollection]ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¦‹ã¤ã‘ã€[Update Collection]ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã€‚

ã™ã‚‹ã¨ã€[ButtonParent]ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å­ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæ•´åˆ—ã—ã¾ã™ã€‚

![](/images/hololens-2022-2/2022-02-13-01-09-11.png)

## ã‚¢ãƒ—ãƒª ã‚»ãƒƒã‚·ãƒ§ãƒ³é–“ã§ Azure Spatial Anchors ã‚’ä¿æŒã™ã‚‹

> HoloLens ã®ãƒ­ãƒ¼ã‚«ãƒ« ãƒ‡ã‚£ã‚¹ã‚¯ã¨ã®é–“ã§ã€Azure Anchor ID ã‚’ä¿å­˜ãŠã‚ˆã³å–å¾—ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦å­¦ç¿’ã—ã¾ã™ã€‚ ã“ã‚Œã«ã‚ˆã‚Šã€ç•°ãªã‚‹ã‚¢ãƒ—ãƒª ã‚»ãƒƒã‚·ãƒ§ãƒ³é–“ã§åŒã˜ã‚¢ãƒ³ã‚«ãƒ¼ ID ã® Azure ã«å¯¾ã—ã¦ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚ å›ºå®šã•ã‚ŒãŸãƒ›ãƒ­ã‚°ãƒ©ãƒ ã‚’å‰ã®ã‚¢ãƒ—ãƒª ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨åŒã˜å ´æ‰€ã«é…ç½®ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

Hierarchyãƒ“ãƒ¥ãƒ¼ã§[ButtonParent]ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å±•é–‹ã—ã€[SaveAzureAnchorIdToDisk]ã¨[GetAzureAnchorIdFromDisk]ã¨ã„ã†åå‰ã®2ã¤ã®ãƒœã‚¿ãƒ³ã‚’æ¢ã—ã¾ã™ã€‚

## ASA ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ ãƒ‘ãƒãƒ«ã‚’è¨­å®šã™ã‚‹

- Hierarchyãƒ“ãƒ¥ãƒ¼ã§[Instructions]>[TextContent]ã‚’å³ã‚¯ãƒªãƒƒã‚¯
- [3DObject]>[Text - TextMeshPro]ã‚’é¸æŠã—ã¦ä½œæˆã€‚

![](/images/hololens-2022-2/2022-02-13-01-21-57.png)

æ–°ã—ãä½œæˆã—ãŸ(TMP)ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã—

- åå‰ã‚’ã€ŒFeedbackã€ã«å¤‰æ›´
- [Rect Transform]ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® [Pos Y]ã‚’`-0.24`ã«å¤‰æ›´ã—ã¾ã™ã€‚
- [Rect Transform]ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® [Width] ã‚’ `0.555` ã«å¤‰æ›´ã—ã¾ã™ã€‚
- [Rect Transform]ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® [Height] ã‚’ `0.1` ã«å¤‰æ›´ã—ã¾ã™ã€‚
- [TextMeshPro - Text] ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® [Font Style] ã‚’ [Bold] ã«å¤‰æ›´ã—ã¾ã™ã€‚
- [TextMeshPro - Text] ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® [Font Size] ã‚’ `0.17` ã«å¤‰æ›´ã—ã¾ã™ã€‚
- [TextMeshPro - Text] ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® [Alignment] ã‚’ä¸­å¤®æƒãˆã«å¤‰æ›´ã—ã¾ã™ã€‚

![](/images/hololens-2022-2/2022-02-13-01-25-45.png)

[Feedback]ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã—ãŸçŠ¶æ…‹ã§

- AddComponentã§[Anchor Feedback Script (Script)]ã‚’é¸æŠ
- [Anchor Feedback Script]ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®FeedbackTextãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã€Feedbackã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰²ã‚Šå½“ã¦ã‚‹ã€‚

![](/images/hololens-2022-2/2022-02-13-01-31-11.png)

# ãƒ¢ãƒã‚¤ãƒ«(iOS,Android)å…±é€šã®è¨­å®š

ã“ã“ã¾ã§ã¯HoloLensç”¨ã®è¨­å®šã§ã—ãŸã€‚
ã“ã®ç« ã‹ã‚‰ã€ãƒ¢ãƒã‚¤ãƒ«(iOS,Android)å…±é€šã®è¨­å®šã®è¨­å®šã‚’èª¬æ˜ã—ã¾ã™ã€‚å¾Œã®ç« ã§ã¯iOS,Androidå›ºæœ‰ã®è¨­å®šã®èª¬æ˜ã‚’ã—ã¾ã™ã€‚

## æ‰‹é †

Hierarchyãƒ“ãƒ¥ãƒ¼ã§[MixedRealityToolkit]ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã™ã‚‹ã€‚æ¬¡ã«Inspectorãƒ“ãƒ¥ãƒ¼ã§[Camera]ã‚¿ãƒ–ã‚’é¸æŠã€‚

- ç¾åœ¨ã®Profileã‚’Cloneã—ã¦ã€ŒAzureSpatialAnchors_ARCameraProfileã€ç­‰ã¨åå‰ã‚’ä»˜ã‘ã‚‹ã€‚
- [Camera Settings Providers]ã‚’å±•é–‹ã—ã¦ã€[XR SDK Windows Mixed Reality Camera Settings]ã‚’å«ã‚€ã™ã¹ã¦ã®[CameraSettings]ã‚’ã€Œ-ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å‰Šé™¤ã™ã‚‹ã€‚

![](/images/hololens-2022-2/2022-02-13-00-14-18.png)

ç¶šã„ã¦ã€
- [Add Camera Settings Provider]ã‚’é¸æŠ
- [Type]ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‹ã‚‰[Microsoft.MixedReality.Toolkit.Experimental.UnityAR]>[UnityARCameraSettings]ã‚’é¸æŠ

![](/images/hololens-2022-2/2022-02-13-00-15-34.png)

Unityãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰[Mixed Reality]>[Toolkit]>[Utilities]>[UnityAR]>[Update Scripting Defines]ã‚’é¸æŠ

![](/images/hololens-2022-2/2022-02-13-00-17-52.png)

Mixrosoft Mixed Reality Feature Toolã‚’ç«‹ã¡ä¸Šã’

- Azure Spatial Anchors SDK for Android 2.12.0
- Azure Spatial Anchors SDK for iOS 2.12.0

ã‚’é¸æŠã—[Get Features]ã‚’é¸æŠã€‚ãã®å¾Œ[Import]ã€[Approve]ã‚’é¸æŠã€‚

![](/images/hololens-2022-2/2022-02-13-02-16-29.png)

# Androidå‘ã‘ãƒ“ãƒ«ãƒ‰ã®è¨­å®š

## æ‰‹é †
Unityãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§[File]>[Build Settings]ã‚’é¸æŠã—ã¦ã€ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’[Android]ã«å¤‰æ›´ã™ã‚‹ã€‚

Unityãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§[Mixed Reality]>[Toolkit]>[Utilities]>[Configure Project for MRTK]ã‚’é¸æŠ

å…¨ã¦ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ã€[Apply]ã‚’é¸æŠã€‚(ã“ã®ç”»é¢ãŒå‡ºãªã‹ã£ãŸå ´åˆã¯Skip This Stepã‚’é¸æŠ)

![](/images/hololens-2022-2/2022-02-13-02-00-00.png)

- [ProjectSettings]>[Player]ã‚’é¸æŠ
- [Other Settings]>[Graphics APIs]ã®[Vulkan]ã‚’é¸æŠã—ã€Œ-ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—å‰Šé™¤ã™ã‚‹ã€‚

![](/images/hololens-2022-2/2022-02-13-02-04-46.png)

- [Project Settings] > [XR Plug-in Management]ã‚’é¸æŠ
- [Windows Platform]ã®ã‚¿ãƒ–ã‚’é¸æŠ
- OpenXRã§ã®è­¦å‘Šãƒãƒ¼ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯
- [Fix All]ã‚’ã‚¯ãƒªãƒƒã‚¯

![](/images/hololens-2022-2/2022-02-13-02-08-43.png)

- [Project Settings] > [XR Plug-in Management]ã‚’é¸æŠ
- [Android Platform]ã®ã‚¿ãƒ–ã‚’é¸æŠ
- [ARCore]ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹

![](/images/hololens-2022-2/2022-02-13-02-11-20.png)

Androidã®Minimum API Levelã‚’24ã«è¨­å®šã™ã‚‹ã€‚

- [Project Settings]>[Player]>[Public Settings]>[Identification]>[Minimum API Level]ã‚’[Android7.0 (API Level24)]ã«è¨­å®šã™ã‚‹ã€‚

![](/images/hololens-2022-2/2022-02-13-02-27-50.png)

mainTemplate.gradle ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ§‹æˆã™ã‚‹

- [Project Settings]>[Player]>[Androidã‚¢ã‚¤ã‚³ãƒ³]ã‚’é¸æŠ
- [Publishing Settings]>[Build]ã‚»ã‚¯ã‚·ãƒ§ãƒ³>[Custom Main Gradle Template]ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã€‚ã™ã‚‹ã¨Gradle Templateãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹ã€‚
- Assets/Plugins/Android/mainTemplate.gradleãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã§é–‹ã
- `dependencies`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã€æ¬¡ã®ä¾å­˜é–¢ä¿‚ã‚’è²¼ã‚Šä»˜ã‘ã‚‹ã€‚

```gradle:mainTemplate.gradle
implementation('com.squareup.okhttp3:okhttp:[3.11.0]')
implementation('com.microsoft.appcenter:appcenter-analytics:[1.10.0]')
```

ã™ã¹ã¦å®Œäº†ã™ã‚‹ã¨ã€`dependencies`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```gradle:mainTemplate.gradle
dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    implementation('com.squareup.okhttp3:okhttp:[3.11.0]')
    implementation('com.microsoft.appcenter:appcenter-analytics:[1.10.0]')
**DEPS**}
```

![](/images/hololens-2022-2/2022-02-13-03-15-55.png)

ã“ã“ã¾ã§æ¥ãŸã‚‰ã€PCã¨Androidã‚’USBã§ã¤ãªã„ã§ **Build And Run**

## å‚è€ƒè¨˜äº‹

https://docs.microsoft.com/ja-jp/azure/spatial-anchors/how-tos/setup-unity-project?tabs=xr-plugin-framework%2Cunity-2020%2Cunity-package-web-ui


# iOSå‘ã‘ãƒ“ãƒ«ãƒ‰ã®è¨­å®š

## é–‹ç™ºç’°å¢ƒ

iOSã‚¢ãƒ—ãƒªã¯Macã§ãªã„ã¨é–‹ç™ºã§ããªã„ã®ã§ã€é–‹ç™ºæ©ŸWindowsã‹ã‚‰Macã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã€‚

## æ‰‹é †


Unityãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§[File]>[Build Settings]ã‚’é¸æŠã—ã¦ã€ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’[iOS]ã«å¤‰æ›´ã™ã‚‹ã€‚

- [Project Settings] > [XR Plug-in Management]ã‚’é¸æŠ
- [iOS Platform]ã®ã‚¿ãƒ–ã‚’é¸æŠ
- [ARKit]ã«**ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹**
![](/images/hololens-2022-2/2022-02-13-03-28-34.png)

- [Project Settings] > [Player]ã‚’é¸æŠ
- [Other Settings]> [Optimization]ã‚»ã‚¯ã‚·ãƒ§ãƒ³ > [Strip Engine Code]ã®**ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã™**

![](/images/hololens-2022-2/2022-02-13-03-33-56.png)

- [Camera Usage Description]ã‚’ç©ºæ¬„ã«ã—ãªã„ã‚ˆã†ã«ã™ã‚‹
  - ä¾‹ãˆã°ã€ŒUse Cameraã€ã¨å…¥åŠ›

![](/images/hololens-2022-2/2022-02-13-03-44-04.png)

[Assets/MRTK.Tutorials.AzureSpatialAnchors/Plugins/RestSharp]ã‚’é¸æŠã€‚

- [iOS]ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹
- [ARKit]ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹
- [Apply]ã‚’ã‚¯ãƒªãƒƒã‚¯

![](/images/hololens-2022-2/2022-02-13-04-11-19.png)

ã“ã“ã¾ã§æ¥ãŸã‚‰XCodeå‘ã‘ã«Build

# Azure Spatial Anchorsã®è©¦ã—æ–¹

https://docs.microsoft.com/ja-jp/learn/modules/azure-spatial-anchors-tutorials/3-exercise-get-started-with-azure-spatial-anchors

ã“ã¡ã‚‰ã®è¨˜äº‹ã‹ã€ãƒ“ãƒ«ãƒ‰ã—ãŸã‚¢ãƒ—ãƒªã®æŒ‡ç¤ºã«å¾“ã£ã¦å‹•ä½œã•ã›ã¾ã™ã€‚

1. Cubeã‚’åˆ¥ã®å ´æ‰€ã«ç§»å‹•ã—ã¾ã™
1. Start Azure Sessionã‚’æŠ¼ã™
1. Create Azure Anchorã‚’æŠ¼ã™ (Cubeã®å ´æ‰€ã«Anchorã‚’ä½œæˆã—ã¾ã™)
1. Stop Azure Sessionã‚’æŠ¼ã™
1. Remove Local Anchorã‚’æŠ¼ã™ (ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯Cubeã‚’ç§»å‹•ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹)
1. Cubeã‚’åˆ¥ã®å ´æ‰€ã«ç§»å‹•ã•ã›ã‚‹
1. Start Azure Sessionã‚’æŠ¼ã™
1. Find Azure Anchorã‚’æŠ¼ã™ ** (ã“ã‚Œã§3.ã®ä½ç½®ã«CubeãŒç¬é–“ç§»å‹•ã™ã‚Œã°æˆåŠŸ) ** 
1. Delete Azure Anchorã‚’æŠ¼ã™
1. Stop Azure Sessionã‚’æŠ¼ã™

ã™ã‚‹ã¨ã€iOSã¨Androidã§ã¯æƒ³å®šé€šã‚Šã«å‹•ä½œã—ã¾ã™ã€‚

https://youtu.be/xjDg0AYUPYo

# ä»Šå¾Œã®èª²é¡Œ

ä¸€ç•ªã‚„ã‚ŠãŸã„ã®ã¯ã€ã“ã¡ã‚‰ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®æŒ™å‹•ã§ã™ã€‚

https://docs.microsoft.com/ja-jp/learn/modules/azure-spatial-anchors-tutorials/5-exercise-save-retrieve-share-azure-spatial-anchors

ã¤ã¾ã‚Šã“ã‚Œã§ã™ã€‚

![](https://docs.microsoft.com/ja-jp/azure/spatial-anchors/media/cross-platform.png)

ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®ä¸‹ã®æ–¹ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’å®Ÿè¡Œã—ã‚ˆã†ã¨ã—ã¾ã—ãŸã€‚

> æ›´æ–°ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚’ 2 ã¤ã® HoloLens ãƒ‡ãƒã‚¤ã‚¹ã«ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ã€Azure Anchor ID ã‚’å…±æœ‰ã™ã‚‹ã“ã¨ã§ã€ç©ºé–“çš„ãªä½ç½®åˆã‚ã›ã‚’å®Ÿç¾ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ ã“ã‚Œã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã«ã¯ã€æ¬¡ã®æ‰‹é †ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

å®Ÿéš›ã¯HoloLensã®2ã¤ç›®ã®ãƒ‡ãƒã‚¤ã‚¹ã‚’æŒã£ã¦ã„ãªã„ãŸã‚ã€iPhoneã§ä»£ç”¨ã—ã¦ã„ã¾ã™ã€‚æ¬¡ã®ã‚ˆã†ãªå‡¦ç†ã«ãªã‚Šã¾ã™ã€‚

1. HoloLensã§æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚Rover Explorer ã‚’ç›®çš„ã®å ´æ‰€ã«ç§»å‹•ã—ã¾ã™ã€‚
2. HoloLensã§: Azure ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã—ã¾ã™ã€‚
3. HoloLensã§: Azure ã‚¢ãƒ³ã‚«ãƒ¼ã‚’ä½œæˆã—ã¾ã™ (Rover Explorer ã®å ´æ‰€ã«ã‚¢ãƒ³ã‚«ãƒ¼ã‚’ä½œæˆã—ã¾ã™)ã€‚
4. HoloLensã§: Azure ã‚¢ãƒ³ã‚«ãƒ¼ ID ã‚’ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å…±æœ‰ã—ã¾ã™ã€‚
5. iPhone ã§æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã¾ã™ã€‚
6. iPhone ã§æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰å…±æœ‰ã‚¢ãƒ³ã‚«ãƒ¼ ID ã‚’å–å¾—ã—ã¾ã™ (HoloLensã‹ã‚‰å…±æœ‰ã•ã‚ŒãŸã‚¢ãƒ³ã‚«ãƒ¼IDã‚’å–å¾—ã—ã¾ã™)ã€‚
7. iPhoneã§: Azure ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã—ã¾ã™ã€‚
8. iPhoneã§: Azure ã‚¢ãƒ³ã‚«ãƒ¼ã‚’æ¤œç´¢ã—ã¾ã™ (æ‰‹é † 3 ã®å ´æ‰€ã« Rover Explorer ã‚’é…ç½®ã—ã¾ã™)ã€‚

ã“ã“ã§6.ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰å…±æœ‰ã‚¢ãƒ³ã‚«ãƒ¼å–å¾—ãŒã§ããªã„...ã¨ã„ã†ã¨ã“ã‚ã§è©°ã¾ã£ã¦ã„ã¾ã™ã€‚

4ã®å‡¦ç†ã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã‚‹ã¨ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã«AnchorIDã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å‡¦ç†ãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹ã‚‚ã®ã®ã€å®Ÿè¡Œã™ã‚‹ã¨è©²å½“ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹å…ˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯AnchorIDãŒè¨˜ã•ã‚Œã¦ã„ãªã„çŠ¶æ…‹ã§ã—ãŸã€‚

ã„ãšã‚Œã«ã—ã¦ã‚‚ã€AnchorIDã‚’èª°ã«ã§ã‚‚è¦‹ã‚Œã‚‹å ´æ‰€ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã®ã¯è‰¯ããªã„ã¨æ€ã†ã®ã§ã€æ¬¡å›ã¯AnchorIDã‚’å®‰å…¨ã«å…±æœ‰ã™ã‚‹æ–¹æ³•ã‚‚å«ã‚ã¦èª¿æŸ»ã—ã¾ã™ã€‚

ã¾ãŸã€HoloLensã§ã¯iOS,Androidã§æˆåŠŸã—ãŸã‚ˆã†ãªã€ŒFind Azure Anchorã€æ™‚ã«å…ƒã®ä½ç½®ã«æˆ»ã‚‰ãªã„ç¾è±¡ã«ã¤ã„ã¦ã‚‚ã€å¼•ãç¶šãèª¿æŸ»ã—ã¾ã™ã€‚

```csharp:AnchorModuleScript.cs
  public void ShareAzureAnchorIdToNetwork()
    {
        Debug.Log("\nAnchorModuleScript.ShareAzureAnchorID()");

        string filename = "SharedAzureAnchorID." + publicSharingPin;
        string path = Application.persistentDataPath;

#if WINDOWS_UWP
        StorageFolder storageFolder = ApplicationData.Current.LocalFolder;
        path = storageFolder.Path + "/";           
#endif

        string filePath = Path.Combine(path, filename);
        File.WriteAllText(filePath, currentAzureAnchorID);

        Debug.Log($"Current Azure anchor ID '{currentAzureAnchorID}' successfully saved to path '{filePath}'");

        try
        {
            var client = new RestClient("http://167.99.111.15:8090");

            Debug.Log($"Connecting to network client '{client}'... please wait...");

            var request = new RestRequest("/uploadFile.php", Method.POST);
            request.AddHeader("Accept", "application/json");
            request.AddHeader("Content-Type", "multipart/form-data");
            request.AddFile("the_file", filePath);
            request.AddParameter("replace_file", 1);  // Only needed if you want to upload a static file

            var httpResponse = client.Execute(request);

            Debug.Log("Uploading file... please wait...");

            string json = httpResponse.Content.ToString();
        }
        catch (Exception ex)
        {
            Debug.Log(string.Format("Exception: {0}", ex.Message));
            throw;
        }

        Debug.Log($"Current Azure anchor ID '{currentAzureAnchorID}' shared successfully");
    }
```